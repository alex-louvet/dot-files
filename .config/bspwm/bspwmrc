#!/bin/sh

pgrep -x sxhkd > /dev/null || sxhkd &
# === POLYBAR COMPATIBILITY ===
# Reserve space for a 25px bar at the top
bspc config top_padding 25

# === WINDOW BORDER / GAPS ===
bspc config border_width         2
bspc config window_gap           5
bspc config single_monocle       true

# === COLORS (based on your i3 theme) ===
bspc config focused_border_color        "#DCD7BA"
bspc config active_border_color         "#484e50"
bspc config normal_border_color         "#1F1F28"
bspc config presel_feedback_color       "#DCD7BA"
bspc config urgent_border_color         "#E82424"

# === WINDOW BEHAVIOR ===
bspc config split_ratio         0.52
bspc config borderless_monocle  true
bspc config gapless_monocle     true
bspc config focus_follows_pointer true

bspc rule -a '*:*:fncmpcpp' state=floating rectangle=1000x1000
bspc rule -a 'yad' state=floating rectangle=300x200+800+30
bspc rule -a '*:*:YAD' state=floating rectangle=300x200+800+30

~/bin/update_display.sh
# === MONITOR / WORKSPACE SETUP ===
# Detect connected monitors
MONITORS=$(bspc query -M --names)

# Get monitor count
MON_COUNT=$(echo "$MONITORS" | wc -l)

if [ "$MON_COUNT" -eq 1 ]; then
    # --- Single monitor setup ---
    MON=$(echo "$MONITORS")
    echo "Single monitor: $MON"

    # Assign 10 workspaces (desktops)
    bspc monitor "$MON" -d 1 2 3 4 5 6 7 8 9 10

else
    # --- Multi-monitor setup ---
    MON1=$(echo "$MONITORS" | sed -n 1p)
    MON2=$(echo "$MONITORS" | sed -n 2p)

    echo "Dual monitor setup: $MON1 and $MON2"

    # Assign 5 desktops per monitor
    bspc monitor "$MON1" -d 1 2 3 4 5
    bspc monitor "$MON2" -d 6 7 8 9 10
fi


# === AUTOSTART APPS ===
# Equivalent to your exec --no-startup-id lines
# (Start only once with `pgrep -x` guards)
pgrep -x nm-applet || nm-applet &
pgrep -x blueman-applet || blueman-applet &
pgrep -x feh || feh --bg-center ~/Pictures/TCR27_desktop_1920.png &
pgrep -x seafile-applet || seafile-applet &
pgrep -x mattermost-desktop || mattermost-desktop &
pgrep -x agent-ui || /opt/Atempo/HN/bin/AgentUI/agent-ui --no-sandbox &
pgrep -x polybar || ~/.config/polybar/bspwm.sh &
pgrep -x nextcloud || nextcloud &
pgrep -x mopidy || mopidy &
for i in `seq 1 10`
do
    bsp-layout set tall $i
done
pkill -USR1 -x sxhkd

